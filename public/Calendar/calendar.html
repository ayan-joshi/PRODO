<!DOCTYPE html>
<html lang=en>

<head>
    <meta charset="utf-8">
    <meta name="description" content="a description">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PRODO</title>
    <!-- title bar icon -->
    <link rel="icon" href="../logo_icon.png" type="image/icon type">

    <!-- Font Awesome Icon-->
    <!-- <script src='https://kit.fontawesome.com/a076d05399.js' crossorigin='anonymous'></script> -->

    <!-- BootStrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <link rel="stylesheet" href="calendar.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Code">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

        <!-- auth -->
        <script type="module">   
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-auth.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
                    apiKey: "AIzaSyAxQ8RpmZMUcoLk4jfQ2rXk5S7ckfDJKkI",
                    authDomain: "student-webdesk.firebaseapp.com",
                    databaseURL: "https://student-webdesk-default-rtdb.firebaseio.com",
                    projectId: "student-webdesk",
                    storageBucket: "student-webdesk.appspot.com",
                    messagingSenderId: "594056866812",
                    appId: "1:594056866812:web:3dd340a4f54dd149f42079"
                };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const eventsCollection = collection(db, "calendarEvents");

    calendarMain();

    function calendarMain() {
      const DEFAULT_OPTION = "Choose category";

      let inputElem,
        inputElem2,
        dateInput,
        timeInput,
        addButton,
        sortButton,
        selectElem,
        calendarEventList = [];

      getElements();
      addListeners();
      load();
      renderRows();
      updateSelectOptions();

      function getElements() {
        inputElem = document.getElementsByTagName("input")[0];
        inputElem2 = document.getElementsByTagName("input")[1];
        dateInput = document.getElementById("dateInput");
        timeInput = document.getElementById("timeInput");
        addButton = document.getElementById("addBtn");
        sortButton = document.getElementById("sortBtn");
        selectElem = document.getElementById("categoryFilter");
      }

      function addListeners() {
        addButton.addEventListener("click", addEntry, false);
        sortButton.addEventListener("click", sortEntry, false);
        selectElem.addEventListener("change", filterEntries, false);
      }

      function addEntry(event) {
        console.log("this function ran");
        let inputValue = inputElem.value;
        let inputValue2 = inputElem2.value;
        let dateValue = dateInput.value;
        let timeValue = timeInput.value;

        const command = {
          ended: "No",
          title: inputValue,
          category: inputValue2,
          date: dateValue,
          time: timeValue,
        };

        addDoc(eventsCollection, command)
          .then((docRef) => {
            console.log("Document written with ID: ", docRef.id);
          })
          .catch((error) => {
            console.error("Error adding document: ", error);
          });

        inputElem.value = "";
        inputElem2.value = "";
        dateInput.value = "";
        timeInput.value = "";

        let obj = {
          id: _uuid(),
          todo: inputValue,
          category: inputValue2,
          date: dateValue,
          time: timeValue,
          done: false,
        };

        rendowRow(obj);

        calendarEventList.push(obj);

        save();
        updateSelectOptions();
      }

      function filterEntries() {
        let selection = selectElem.value;

        // Empty the table, keeping the first row
        let trElems = document.getElementsByTagName("tr");
        for (let i = trElems.length - 1; i > 0; i--) {
          trElems[i].remove();
        }

        if (selection == DEFAULT_OPTION) {
          calendarEventList.forEach((obj) => rendowRow(obj));
        } else {
          calendarEventList.forEach((obj) => {
            if (obj.category == selection) {
              rendowRow(obj);
            }
          });
        }
      }

      function updateSelectOptions() {
        let options = [];

        calendarEventList.forEach((obj) => {
          options.push(obj.category);
        });

        let optionsSet = new Set(options);

        // empty the select options
        selectElem.innerHTML = "";

        let newOptionElem = document.createElement('option');
        newOptionElem.value = DEFAULT_OPTION;
        newOptionElem.innerText = DEFAULT_OPTION;
        selectElem.appendChild(newOptionElem);

        for (let option of optionsSet) {
          let newOptionElem = document.createElement('option');
          newOptionElem.value = option;
          newOptionElem.innerText = option;
          selectElem.appendChild(newOptionElem);
        }
      }

      function save() {
        let stringified = JSON.stringify(calendarEventList);
        localStorage.setItem("calendarEventList", stringified);
      }

      function load() {
        let retrieved = localStorage.getItem("calendarEventList");
        calendarEventList = JSON.parse(retrieved);
        if (calendarEventList == null)
          calendarEventList = [];
      }

      function renderRows() {
        calendarEventList.forEach((todoObj) => {
          rendowRow(todoObj);
        });
      }

      function rendowRow({ todo: inputValue, category: inputValue2, id, date, time, done }) {
        // add a new row

        let table = document.getElementById("eventTable");
        let trElem = document.createElement("tr");
        table.appendChild(trElem);

        // checkbox cell
        let checkboxElem = document.createElement("input");
        checkboxElem.type = "checkbox";
        checkboxElem.addEventListener("click", checkboxClickCallback, false);
        checkboxElem.dataset.id = id;
        let tdElem1 = document.createElement("td");
        tdElem1.appendChild(checkboxElem);
        trElem.appendChild(tdElem1);

        // to-do cell or title cell
        let tdElem2 = document.createElement("td");
        tdElem2.innerText = inputValue;
        trElem.appendChild(tdElem2);

        // date cell
        let dateElem = document.createElement("td");
        let dateObj = new Date(date);
        let formattedDate = dateObj.toLocaleString("en-GB", {
          month: "long",
          day: "numeric",
          year: "numeric",
        });

        dateElem.innerText = formattedDate;
        trElem.appendChild(dateElem);

        // time cell
        let timeElem = document.createElement("td");
        timeElem.innerText = time;
        trElem.appendChild(timeElem);

        // category cell
        let tdElem3 = document.createElement("td");
        tdElem3.innerText = inputValue2;
        tdElem3.className = "categoryCell";
        trElem.appendChild(tdElem3);

        // delete cell
        let spanElem = document.createElement("span");
        spanElem.innerText = "delete";
        spanElem.className = "material-icons";
        spanElem.addEventListener("click", deleteItem, false);
        spanElem.dataset.id = id;
        let tdElem4 = document.createElement("td");
        tdElem4.appendChild(spanElem);
        trElem.appendChild(tdElem4);

        checkboxElem.type = "checkbox";
        checkboxElem.checked = done;
        if (done) {
          trElem.classList.add("strike");
        } else {
          trElem.classList.remove("strike");
        }

        function deleteItem() {
          trElem.remove();
          updateSelectOptions();

          for (let i = 0; i < calendarEventList.length; i++) {
            if (calendarEventList[i].id == this.dataset.id)
              calendarEventList.splice(i, 1);
          }
          save();
        }

        function checkboxClickCallback() {
          trElem.classList.toggle("strike");
          for (let i = 0; i < calendarEventList.length; i++) {
            if (calendarEventList[i].id == this.dataset.id)
              calendarEventList[i]["done"] = this.checked;
          }
          save();
        }
      }

      function _uuid() {
        var d = Date.now();
        if (typeof performance !== 'undefined' && typeof performance.now === 'function') {
          d += performance.now();
        }
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
          var r = (d + Math.random() * 16) % 16 | 0;
          d = Math.floor(d / 16);
          return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
        });
      }

      function sortEntry() {
        calendarEventList.sort((a, b) => {
          let aDate = Date.parse(a.date);
          let bDate = Date.parse(b.date);
          return aDate - bDate;
        });
        save();
        let trElems = document.getElementsByTagName("tr");
        for (let i = trElems.length - 1; i > 0; i--) {
          trElems[i].remove();
        }
        renderRows();
      }
    }

        </script>
</head>

<body>
    <!-- <div id="body_container"> -->
    <!-- <div class="header">
            <a href="../NewTab/newtab.html">
                <div class="logo_box">
                    <img src="../Images/logo_icon.png" id="logo">
                    <h1 id="web_app_name">PRODO</h1>
                </div>
            </a>

            <div class="menu_bar">
                <a href="../Dashboard/dashboard.html">
                    <h3 id="menu_dashboard">Dashboard</h3>
                </a>
                <h3 id="menu_calendar">Calendar</h3>
                <a href="../ToDo/todo.html">
                    <h3 id="menu_todo">Kanban</h3>
                </a>
                <a href="../Pomodoro/">
                    <h3 id="menu_study">Pomodoro</h3>
                </a>
                <a href="../Pricing/Pricing.html">
                    <h3 id="menu_Pricing">Pricing</h3>
                </a>
                <a href="../Notes/notes.html">
                    <h3 id="menu_notes">Notes</h3>
                </a>
            </div> -->

            <!-- user card -->
            <!-- <div id="userCard" class="card bg-light"
                style="display: none; position: relative; right: 10%; top: 0px; text-align: center; padding: 5px; height: 40px;">
                <div id="userIcon">
                    <i style="font-size: 24px; color: rgb(85,208,156);" class='fas fa-user-astronaut'></i>
                    <span style="font-size: 16px;" id="userInfoEmail"></span>
                </div>

            </div> -->

            <!--logout button-->
            <!-- <div id="logoutButton" style="display: none; position: absolute; right: 4%; top: 20px;">
                <button onclick="" class="btn btn-primary">Logout</button>
            </div> -->
            
            <!-- </div> -->
            <div class="main">
                <div class="sidebar">
                    <!-- Sidebar content with SVG icons -->
            
                    <ul>
                        <li style="font-size: 25px;font-weight: bold;">PRODO</li>
                        <li>
                            <a href="../Dashboard/dashboard.html">
                                <?xml version="1.0" ?><svg baseProfile="tiny" height="100px" id="Layer_1" version="1.2"
                                    viewBox="0 0 24 24" width="100px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
                                    xmlns:xlink="http://www.w3.org/1999/xlink">
                                    <path
                                        d="M12,3c0,0-6.186,5.34-9.643,8.232C2.154,11.416,2,11.684,2,12c0,0.553,0.447,1,1,1h2v7c0,0.553,0.447,1,1,1h3  c0.553,0,1-0.448,1-1v-4h4v4c0,0.552,0.447,1,1,1h3c0.553,0,1-0.447,1-1v-7h2c0.553,0,1-0.447,1-1c0-0.316-0.154-0.584-0.383-0.768  C18.184,8.34,12,3,12,3z"
                                        fill="white" />
                                </svg>
                            </a>
                        </li>
                        <li>
                            <a href="../Calendar/calendar.html">
                                <?xml version="1.0" ?><svg class="svg" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M1 4c0-1.1.9-2 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V4zm2 2v12h14V6H3zm2-6h2v2H5V0zm8 0h2v2h-2V0zM5 9h2v2H5V9zm5 0h2v2h-2V9zm0 4h2v2h-2v-2zm4 0h2v2h-2v-2zm0 4h2v2h-2v-2z"
                                        fill="white" />
                                </svg>
                            </a>
                        </li>
                        <li>
                            <a href="../ToDo/ToDo.html">
                                <?xml version="1.0" ?><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M80 48h-64C7.156 48 0 55.16 0 64v64c0 8.844 7.156 16 16 16h64C88.84 144 96 136.8 96 128V64C96 55.16 88.84 48 80 48zM80 208h-64C7.156 208 0 215.2 0 224v64c0 8.844 7.156 16 16 16h64C88.84 304 96 296.8 96 288V224C96 215.2 88.84 208 80 208zM80 368h-64C7.156 368 0 375.2 0 384v64c0 8.844 7.156 16 16 16h64C88.84 464 96 456.8 96 448v-64C96 375.2 88.84 368 80 368zM192 128h288c17.67 0 32-14.33 32-31.1S497.7 64 480 64H192C174.3 64 160 78.33 160 95.1S174.3 128 192 128zM480 384H192c-17.67 0-32 14.33-32 32s14.33 32 32 32h288c17.67 0 32-14.33 32-32S497.7 384 480 384zM480 224H192C174.3 224 160 238.3 160 256s14.33 32 32 32h288c17.67 0 32-14.33 32-32S497.7 224 480 224z"
                                        fill="white" />
                                </svg>
                            </a>
                        </li>
                        <li>
                            <a href="../Pomodoro/Pomodoro.html">
                                <?xml version="1.0" ?><svg id="Layer_1_1_" style="enable-background:new 0 0 16 16;" version="1.1"
                                    viewBox="0 0 16 16" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
                                    xmlns:xlink="http://www.w3.org/1999/xlink">
                                    <path
                                        d="M1,9c0,3.866,3.134,7,7,7s7-3.134,7-7c0-3.866-3.134-7-7-7S1,5.134,1,9z M8,3c3.314,0,6,2.686,6,6s-2.686,6-6,6  s-6-2.686-6-6S4.686,3,8,3z"
                                        fill="white" />
                                    <rect height="1" width="4" x="6" fill="white" />
                                    <rect height="2" transform="matrix(0.7071 -0.7071 0.7071 0.7071 2.3329 10.632)" width="1"
                                        x="13.5" y="1.5" fill="white" />
                                    <path d="M8,4v5h5C13,6.239,10.761,4,8,4z" fill="white" />
                                </svg>
                            </a>
                        </li>
                        <li>
                            <a href="../Notes/notes.html">
                                <?xml version="1.0" ?><svg fill="none" class="svg" height="100px" viewBox="0 0 24 24" width="100px"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M6 6C6 5.44772 6.44772 5 7 5H17C17.5523 5 18 5.44772 18 6C18 6.55228 17.5523 7 17 7H7C6.44771 7 6 6.55228 6 6Z"
                                        fill="white" />
                                    <path
                                        d="M6 10C6 9.44771 6.44772 9 7 9H17C17.5523 9 18 9.44771 18 10C18 10.5523 17.5523 11 17 11H7C6.44771 11 6 10.5523 6 10Z"
                                        fill="white" />
                                    <path
                                        d="M7 13C6.44772 13 6 13.4477 6 14C6 14.5523 6.44771 15 7 15H17C17.5523 15 18 14.5523 18 14C18 13.4477 17.5523 13 17 13H7Z"
                                        fill="white" />
                                    <path
                                        d="M6 18C6 17.4477 6.44772 17 7 17H11C11.5523 17 12 17.4477 12 18C12 18.5523 11.5523 19 11 19H7C6.44772 19 6 18.5523 6 18Z"
                                        fill="white" />
                                    <path clip-rule="evenodd"
                                        d="M2 4C2 2.34315 3.34315 1 5 1H19C20.6569 1 22 2.34315 22 4V20C22 21.6569 20.6569 23 19 23H5C3.34315 23 2 21.6569 2 20V4ZM5 3H19C19.5523 3 20 3.44771 20 4V20C20 20.5523 19.5523 21 19 21H5C4.44772 21 4 20.5523 4 20V4C4 3.44772 4.44771 3 5 3Z"
                                        fill="white" fill-rule="evenodd" />
                                </svg>
                            </a>
                        </li>
                    </ul>
            
                </div>

                <div class="container-fluid padding margins right-main">
                    <div class="row">
                        <div class="cal-main">
                            <div class="col-sm-8">
                        
                                <div class="row">
                                    <div class="col-sm-8">
                                        <h3>Calendar Events</h3>
                                    </div>
                        
                                    <!-- Button triggers add event modal -->
                                    <div class="col-sm-4">
                                        <div class="text-right">
                                            <button id="addEventButton" type="button" class="btn btn-primary" data-toggle="modal"
                                                data-target="#addEventModal">
                                                Add event
                                            </button>
                                        </div>
                                    </div>
                                </div>
                        
                                <table class="table table-hover" id="eventTable">
                                    <tr>
                                        <th scope="col">Ended</th>
                                        <th scope="col">Title</th>
                                        <th scope="col">Date</th>
                                        <th scope="col">Time</th>
                                        <th scope="col">
                                            <select id="categoryFilter">
                                            </select>
                                        </th>
                                        <th scope="col">Discard</th>
                                    </tr>
                                </table>
                        
                            </div>
                        </div>



            <!-- add event modal -->
            <div class="modal fade" id="addEventModal" tabindex="-1" role="dialog" aria-labelledby="addEventModalTitle"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addEventModalTitle">Add a new Calendar Event</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                        <form>
                                <div class="form-group">
                                    <!-- heading-->
                                    <h3>Add event</h3>
                                    <hr>

                                    <!-- Event Description-->
                                    <div class="form-group form-check">
                                        <label for="eventTitle">Event Title</label>
                                        <input type="text" class="form-control" id="eventTitle" placeholder="Enter event title">
                                        </div>
                                        <!-- Category -->
                                        <div class="form-group form-check">
                                            <label for="eventCategory">Category</label>
                                        <input type="text" class="form-control" id="eventCategory" placeholder="Enter category" list="categoryList">
                                        <datalist class="form-select" id="categoryList">
                                            <option value="Personal"></option>
                                            <option value="Work"></option>
                                        </datalist>
                                        </div>

                                    <!-- Date -->
                                    <div class="form-group form-check">
                                        <label for="dateInput">Date</label>
                                        <input type="date" class="form-control" id="dateInput">
                                    </div>

                                    <!-- Time -->
                                    <div class="form-group form-check">
                                        <label for="timeInput">Time</label>
                                        <input type="time" class="form-control" id="timeInput">
                                    </div>

                                    <div class="text-right">
                                        <button id="addBtn"  class="btn btn-primary">Add</button>
                                        <button id="sortBtn" class="btn btn-secondary">Sort</button>
                                    </div>
                                    </div>
                                </form>
                                    </div>
                                    </div>
                                    </div>
                                    </div>

            <!-- right panel -->
            <!-- <div class="col-sm-4">
                                                                                                                                                                                                                <div class="bg-image">

                </div> -->

                <!-- Coming soon -->
                </div>
                </div>

        <!-- alert info modal -->
        <div class="modal fade" id="alertInfoModal" tabindex="-1" role="dialog" aria-labelledby="alertInfoModalTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="alertInfoModalTitle">Session ended</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">

                        <div class="alert alert-info" role="alert">
                            You have been logged out. Please login!
                            <small id="alt" class="form-text text-muted">You will be redirected in few seconds. <a href="../index.html">Click
                                    here</a> to get started now.</small>
                            </div>

                    </div>
                    </div>
                    </div>
                    </div>

    </div>
</div>

        <!-- <script src="calender.js"></script> -->

        <!-- BootStrap -->

        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>
</body>

</html>