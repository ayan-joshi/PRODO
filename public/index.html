<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PRODO</title>
  <!-- title bar icon -->
  <link rel="icon" href="logo_icon.png" type="image/icon type">

  <!-- BootStrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <link rel="stylesheet" href="index.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Code">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">

  <!-- update the version number as needed -->
  <script defer src="/__/firebase/9.1.2/firebase-app-compat.js"></script>
  <!-- include only the Firebase features as you need -->
  <script defer src="/__/firebase/9.1.2/firebase-auth-compat.js"></script>
  <script defer src="/__/firebase/9.1.2/firebase-database-compat.js"></script>
  <script defer src="/__/firebase/9.1.2/firebase-firestore-compat.js"></script>
  <script defer src="/__/firebase/9.1.2/firebase-functions-compat.js"></script>
  <script defer src="/__/firebase/9.1.2/firebase-messaging-compat.js"></script>
  <script defer src="/__/firebase/9.1.2/firebase-storage-compat.js"></script>
  <script defer src="/__/firebase/9.1.2/firebase-analytics-compat.js"></script>
  <script defer src="/__/firebase/9.1.2/firebase-remote-config-compat.js"></script>
  <script defer src="/__/firebase/9.1.2/firebase-performance-compat.js"></script>
  <!-- 
      initialize the SDK after all desired features are loaded, set useEmulator to false
      to avoid connecting the SDK to running emulators.
    -->
  <script defer src="/__/firebase/init.js?useEmulator=true"></script>

</head>

<body>

  <div class="header">
    <a href="../NewTab/newtab.html">
      <div class="logo_box">
        <img src="logo_icon.png">
        <h1 id="web_app_name">PRODO</h1>
      </div>
    </a>
    <div class="menu_bar">
      <a href="#">
        <h3 id="log_in" data-toggle="modal" data-target="#loginModal">Login</h3>
      </a>
      <a href="#">
        <h3 id="sign_up" data-toggle="modal" data-target="#signupModal">Sign Up</h3>
      </a>

    </div>
  </div>

  <div class="container-fluid ps-md-0">
    <div class="row g-0">
      <div class="d-none d-md-flex col-md-4 col-lg-6 bg-image"></div>
      <div class="col-md-8 col-lg-6">
        <div class="login d-flex align-items-center py-5">
          <div class="container">
            <div class="row">
              <div class="col-md-9 col-lg-8 mx-auto welcome-text">

                <h1 class="login-heading mb-4">Get organized<br> with PRODO</h1>
                <h3 class="login-heading mb-4">A productivity tool made for students.</h3>

                <!-- Button triggers login modal -->
                <button id="signupButton" type="button" class="btn btn-primary" data-toggle="modal"
                  data-target="#signupModal">
                  Sign Up
                </button>
                <br>
                <hr>
                <p>Already signed up? <a href="#" id="log_in" data-toggle="modal" data-target="#loginModal">Go to
                    login
                  </a></p>

              </div>

              <!-- Login Modal -->
              <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalTitle"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="loginModalTitle">Login with your PRODO account</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <form id="loginForm">
                        <div class="form-group">
                          <label for="loginEmail">Email address</label>
                          <input type="email" class="form-control" id="loginEmail" aria-describedby="emailHelp"
                            placeholder="Enter email">
                          <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone
                            else.</small>
                        </div>
                        <div class="form-group">
                          <label for="loginPassword">Password</label>
                          <input type="password" class="form-control" id="loginPassword" placeholder="Password">
                        </div>

                        <!-- <div class="form-group form-check">
                          <input type="checkbox" class="form-check-input" id="rememberMe">
                          <label class="form-check-label" for="rememberMe">Remember password</label>
                        </div> -->

                        <button type="submit" class="btn btn-primary">Login</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Sign up Modal -->
              <div class="modal fade" id="signupModal" tabindex="-1" role="dialog" aria-labelledby="signupModalTitle"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="signupModalTitle">Sign up to create a new account</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <form id="signupForm">
                        <div class="form-group">
                          <label for="signupEmail">Email address</label>
                          <input type="email" class="form-control" id="signupEmail" aria-describedby="emailHelp"
                            placeholder="Enter email">
                          <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone
                            else.</small>
                        </div>

                        <!-- <div class="form-group">
                          <label for="signupUsername">Username</label>
                          <input type="text" class="form-control" id="signupUsername" aria-describedby="nameHelp"
                            placeholder="Enter username">
                          <small id="nameHelp" class="form-text text-muted">A username is reqired to complete your
                            profile.</small>
                        </div> -->

                        <div class="form-group">
                          <label for="signupPassword">Password</label>
                          <input type="password" class="form-control" id="signupPassword" min="6" max="10"
                            placeholder="Password">
                        </div>

                        <div class="form-group form-check">
                          <p>By clicking Sign Up, you agree to our Terms & Conditions.</p>
                        </div>
                        <button type="submit" class="btn btn-primary">Sign Up</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>

              <!-- sign up alert info modal -->
              <div class="modal fade" id="alertInfoModal" tabindex="-1" role="dialog"
                aria-labelledby="alertInfoModalTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="alertInfoModalTitle">Congratulations</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">

                      <div class="alert alert-info" role="alert">
                        You account has been successfully created!
                        <small id="alt" class="form-text text-muted">You will be redirected in few seconds. <a
                            href="NewTab/newtab.html">Click here</a> to get started now.</small>
                      </div>

                    </div>
                  </div>
                </div>
              </div>

              <!-- login alert info modal -->
              <div class="modal fade" id="alertInfoModal2" tabindex="-1" role="dialog"
                aria-labelledby="alertInfoModalTitle2" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="alertInfoModalTitle2">Welcome!</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">

                      <div class="alert alert-success" role="alert">
                        You have been successfully logged in!
                        <small id="alt" class="form-text text-muted">You will be redirected in few seconds. <a
                            href="NewTab/newtab.html">Click here</a> to get started now.</small>
                      </div>

                    </div>
                  </div>
                </div>
              </div>

              <!-- alert error modal -->
              <div class="modal fade" id="alertErrorModal" tabindex="-1" role="dialog"
                aria-labelledby="alertErrorModalTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="alertErrorModalTitle">Error</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">

                      <div class="alert alert-danger" role="alert">
                        There was an error encountered. Please try again!
                        <small id="alt" class="form-text text-muted">Click the x on the corner to close the
                          window.</small>
                      </div>

                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- BootStrap & JQuery Scripts -->

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>

  <!-- FIREBASE -->
  <script type="module">
    // Import functions
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-auth.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAxQ8RpmZMUcoLk4jfQ2rXk5S7ckfDJKkI",
        authDomain: "student-webdesk.firebaseapp.com",
        databaseURL: "https://student-webdesk-default-rtdb.firebaseio.com",
        projectId: "student-webdesk",
        storageBucket: "student-webdesk.appspot.com",
        messagingSenderId: "594056866812",
        appId: "1:594056866812:web:3dd340a4f54dd149f42079"
      };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore();

    // listen for current user
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // User is signed in
        const uid = user.uid;
        // ...
        console.log(uid);

        //hide all modals
        $("#alertInfoModal").modal('hide');
        $("#signupModal").modal('hide');
        $("#loginModal").modal('hide');

        // show alert
        $("#alertInfoModal2").modal('show');

        // hide after 3 sec
        setTimeout(function () {
          $("#alertInfoModal2").modal('hide');

          window.location.href = '/public/Newtab/newtab.html';
        }, 3000);

      } else {
        // User is signed out
        // ...
        console.log('No session');
      }
    });

    //sign up user
    const signupForm = document.querySelector("#signupForm");

    // Wrap the event handler in an async function
signupForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  const signupEmail = signupForm['signupEmail'].value;
  const signupPassword = signupForm['signupPassword'].value;

  try {
    // Create the user in Firebase Authentication
    const userCredential = await createUserWithEmailAndPassword(auth, signupEmail, signupPassword);
    const user = userCredential.user;

    // Store user details in Firestore
    const db = getFirestore();

    // Define a collection where you want to store user details (e.g., 'users')
    const usersCollection = collection(db, 'users');

    // Define the user data you want to store in Firestore
    const userData = {
      email: signupEmail,
      // Add more user data fields as needed
    };

    // Add the user data to Firestore
    await addDoc(usersCollection, userData);

    // Close the signup modal and reset the form
    $("#signupModal").modal('hide');
    signupForm.reset();

    // Sign up success alert
    $("#alertInfoModal").modal('show');

    // Redirect after 3 seconds
    setTimeout(function () {
      window.location.href = '/public/Newtab/newtab.html';
    }, 3000);
  } catch (error) {
    // Handle errors
    console.error(error);

    // Close window
    $("#signupModal").modal('hide');

    // Show error
    $("#alertErrorModal").modal('show');

    // Hide after 3 seconds and show the signup form again
    setTimeout(function () {
      $("#alertErrorModal").modal('hide');
      $("#signupModal").modal('show');
    }, 3000);
  }
});


    //login user
    const loginForm = document.querySelector("#loginForm");

    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();

      const loginEmail = loginForm['loginEmail'].value;
      const loginPassword = loginForm['loginPassword'].value;

      console.log(loginEmail, loginPassword);

      signInWithEmailAndPassword(auth, loginEmail, loginPassword).then(userCredential => {
        console.log(userCredential);
        const user = userCredential.user;

        console.log(user);
      }).then(() => {
        $("#loginModal").modal('hide');
        signupForm.reset();

        // login success alert
        $("#alertInfoModal2").modal('show');

        // redirect after 3 sec
        setTimeout(function () {
          window.location.href = '/NewTab/newtab.html';
        }, 3000);

      }).catch((error) => {
        // close window
        $("#loginModal").modal('hide');
        const errorCode = error.code;
        const errorMessage = error.message;

        // show error
        $("#alertErrorModal").modal('show');

        // hide after 3 sec
        setTimeout(function () {
          $("#alertErrorModal").modal('hide');
        }, 3000);

      });

    });

  </script>

  <!-- authentication-->
  <script src="auth.js">S</script>

</body>

</html>